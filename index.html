<!doctype html>
<html>
  <head>
    <title>Socket Chat App</title>
    <style>
      #chat {
        height:500px;
      }
      #contentWrap {
        display: none;
      }
      #chatWrap {
        float:left;
        border: 1px #000 solid;
      }
    </style>
  </head>

<body>

  <div id="usernameWrap">
    <p> Enter a username: </p>
    <p id="usernameError"></p>
    <form id="setUsername">
      <input size="35" id="username"></input>
      <input type="submit"></input>
    </form>
  </div>

  <div id="contentWrap">
    <div id="chatWrap">
      <div id="chat"></div>
        <ul id="messages"></ul>
        <form action="">
          <input id="messageBox" autocomplete="off" /><button>Send</button>
        </form>
    </div>
    <div id="users"></div>
  </div>


  <script src="/socket.io/socket.io.js"></script>
  <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
  <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
  <script>
      var socket = io();
      var $messageBox = $('#messageBox');
      var $messages = $('#messages');
      var $usernameForm = $('#setUsername');
      var $usernameError = $('#usernameError');
      var $usernameBox = $('#username');

      $usernameForm.submit(function(e){
        e.preventDefault();
        socket.emit('new user', $usernameBox.val(), function(data){
          if(data) {
            $('#usernameWrap').hide();
            $('#contentWrap').show();
          } else{
            $usernameError.html('That username is already taken! Please try again.')
          }
        });
        $usernameBox.val('');
      });

      socket.on('usernames', function() {
        
      });

      $('form').submit(function(e){
        e.preventDefault();
        socket.emit('send message', $messageBox.val());
        $messageBox.val('');
        return false;
      });
      socket.on('send message', function(msg){
        $messages.append($('<li>').text(msg));
      });
  </script>
</body>

</html>
